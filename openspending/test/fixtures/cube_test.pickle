(dp1
S'javascripts'
p2
(dp3
Vcompute_distincts
p4
ccopy_reg
_reconstructor
p5
(cbson.code
Code
p6
c__builtin__
str
p7
S'// aggregate all distinct values for top level properties for all entries\n// in a dataset and save them into a collection named\n// \'distincts__<dataset_name>\'. For the time property, the values\n// for time.[to,from][day,month,year] are added instead of the\n// \'time\' object.\n//\n// The documents in the collection have the following structure:\n// {_id: <the value>, {value: {keys: [<key>, ...]}}}\n// where _id is the value stored in an entry and \'value.keys\' are all\n// keys where the value is used.\n// To find all distinct values for a certain key in the entry documents\n// query the dedicated collection for {\'value.keys\': key} and use all\n// values for _id.\n\nfunction(dataset_name) {\n\n    // validate input\n    if (dataset_name === undefined) {\n        throw "dataset_name is required";\n    }\n    if (db.dataset.findOne({name: dataset_name}) === null) {\n        throw \'A dataset named "\' + dataset_name + \'" does not exist\';\n    }\n\n    // target colection name and index\n    var collection_name = \'distincts__\' + dataset_name;\n    var collection = db[collection_name];\n    collection.ensureIndex({\'value.keys\': 1});\n\n\n    var _map = function() {\n        // the same keys are used in openspending.model.entry.distinct\n        var known = [\'_id\', \'name\', \'amount\', \'_aggregation\',\n                     \'classifiers\', \'entities\', \'currency\'];\n\n        for (key in this) {\n            if (known.indexOf(key)>-1) {\n                continue;\n            }\n            if (key === \'time\') {\n                emit(this.time.from.year, {keys: [\'time.from.year\']});\n                emit(this.time.from.month, {keys: [\'time.from.month\']});\n                emit(this.time.from.day, {keys: [\'time.from.day\']});\n                emit(this.time.to.year, {keys: [\'time.to.year\']});\n                emit(this.time.to.month, {keys: [\'time.to.month\']});\n                emit(this.time.to.day, {keys: [\'time.to.day\']});\n            }\n            else {\n                emit(this[key], {keys: [key]});\n            }\n        };\n    };\n\n    var _reduce = function(value, emitted_keys) {\n        var result = {keys: []};\n        emitted_keys.forEach(function(emitted) {\n            emitted.keys.forEach(function(key){\n                if (result.keys.indexOf(key) === -1) {\n                    result.keys.push(key);\n                }\n            });\n        });\n        return result;\n    };\n\n    return db.entry.mapReduce(_map, _reduce,\n                              {\n                                  out: collection_name,\n                                  query: {\'dataset.name\': dataset_name}\n                              });\n};\n'
tRp8
(dp9
S'_Code__scope'
p10
(dp11
sbssS'collections'
p12
(dp13
Ventity
p14
(lp15
(dp16
V_id
p17
g5
(cbson.objectid
ObjectId
p18
c__builtin__
object
p19
NtRp20
S'Np\xc5_#\xa0\x0c68\x96-p'
p21
bsVdescription
p22
V
sVname
p23
Va
sVlabel
p24
V
sa(dp25
V_id
p26
g5
(g18
g19
NtRp27
S'Np\xc5_#\xa0\x0c68\x96-q'
p28
bsVdescription
p29
V
sVname
p30
Vb
sVlabel
p31
V
sa(dp32
V_id
p33
g5
(g18
g19
NtRp34
S'Np\xc5_#\xa0\x0c68\x96-r'
p35
bsVdescription
p36
V
sVname
p37
Vc
sVlabel
p38
V
sasVentry
p39
(lp40
(dp41
Vfrom
p42
(dp43
Vlabel
p44
V
sV_id
p45
g5
(g18
g19
NtRp46
S'Np\xc5_#\xa0\x0c68\x96-p'
p47
bsVref
p48
g5
(cbson.dbref
DBRef
p49
g19
NtRp50
(dp51
S'_DBRef__kwargs'
p52
(dp53
sS'_DBRef__collection'
p54
Ventity
p55
sS'_DBRef__database'
p56
NsS'_DBRef__id'
p57
g5
(g18
g19
NtRp58
S'Np\xc5_#\xa0\x0c68\x96-p'
p59
bsbsVdescription
p60
V
sVname
p61
Va
ssVname
p62
V_
sVto
p63
(dp64
Vlabel
p65
V
sV_id
p66
g5
(g18
g19
NtRp67
S'Np\xc5_#\xa0\x0c68\x96-q'
p68
bsVref
p69
g5
(g49
g19
NtRp70
(dp71
g52
(dp72
sg54
Ventity
p73
sg56
Nsg57
g5
(g18
g19
NtRp74
S'Np\xc5_#\xa0\x0c68\x96-q'
p75
bsbsVdescription
p76
V
sVname
p77
Vb
ssVdataset
p78
(dp79
Vtime_axis
p80
Vtime.from.year
p81
sVdescription
p82
V
sVlabel
p83
VTest Dataset
p84
sVcurrency
p85
VGBP
p86
sV_id
p87
V42b402b83a4577ab2cc68ec2df2415c544257200
p88
sVref
p89
g5
(g49
g19
NtRp90
(dp91
g52
(dp92
sg54
Vdataset
p93
sg56
Nsg57
V42b402b83a4577ab2cc68ec2df2415c544257200
p94
sbsVname
p95
Vtest_dataset
p96
ssVcurrency
p97
VGBP
p98
sVentities
p99
(lp100
g5
(g18
g19
NtRp101
S'Np\xc5_#\xa0\x0c68\x96-q'
p102
bag5
(g18
g19
NtRp103
S'Np\xc5_#\xa0\x0c68\x96-p'
p104
basVamount
p105
F1000
sVtime
p106
(dp107
Vfrom
p108
(dp109
Vday
p110
I20090101
sVyear
p111
I2009
sssV_id
p112
V57267fd18b97e0db5742b885200f14504ce648f2
p113
sa(dp114
Vfrom
p115
(dp116
Vlabel
p117
V
sV_id
p118
g5
(g18
g19
NtRp119
S'Np\xc5_#\xa0\x0c68\x96-p'
p120
bsVref
p121
g5
(g49
g19
NtRp122
(dp123
g52
(dp124
sg54
Ventity
p125
sg56
Nsg57
g5
(g18
g19
NtRp126
S'Np\xc5_#\xa0\x0c68\x96-p'
p127
bsbsVdescription
p128
V
sVname
p129
Va
ssVname
p130
V__
p131
sVto
p132
(dp133
Vlabel
p134
V
sV_id
p135
g5
(g18
g19
NtRp136
S'Np\xc5_#\xa0\x0c68\x96-q'
p137
bsVref
p138
g5
(g49
g19
NtRp139
(dp140
g52
(dp141
sg54
Ventity
p142
sg56
Nsg57
g5
(g18
g19
NtRp143
S'Np\xc5_#\xa0\x0c68\x96-q'
p144
bsbsVdescription
p145
V
sVname
p146
Vb
ssVdataset
p147
(dp148
Vtime_axis
p149
Vtime.from.year
p150
sVdescription
p151
V
sVlabel
p152
VTest Dataset
p153
sVcurrency
p154
VGBP
p155
sV_id
p156
V42b402b83a4577ab2cc68ec2df2415c544257200
p157
sVref
p158
g5
(g49
g19
NtRp159
(dp160
g52
(dp161
sg54
Vdataset
p162
sg56
Nsg57
V42b402b83a4577ab2cc68ec2df2415c544257200
p163
sbsVname
p164
Vtest_dataset
p165
ssVcurrency
p166
VGBP
p167
sVentities
p168
(lp169
g5
(g18
g19
NtRp170
S'Np\xc5_#\xa0\x0c68\x96-q'
p171
bag5
(g18
g19
NtRp172
S'Np\xc5_#\xa0\x0c68\x96-p'
p173
basVamount
p174
F1000
sVtime
p175
(dp176
Vfrom
p177
(dp178
Vday
p179
I20090101
sVyear
p180
I2009
sssV_id
p181
V12d86972735cf6b38d87c88f9bbdd65d4b1bd359
p182
sa(dp183
Vfrom
p184
(dp185
Vlabel
p186
V
sV_id
p187
g5
(g18
g19
NtRp188
S'Np\xc5_#\xa0\x0c68\x96-q'
p189
bsVref
p190
g5
(g49
g19
NtRp191
(dp192
g52
(dp193
sg54
Ventity
p194
sg56
Nsg57
g5
(g18
g19
NtRp195
S'Np\xc5_#\xa0\x0c68\x96-q'
p196
bsbsVdescription
p197
V
sVname
p198
Vb
ssVname
p199
V___
p200
sVto
p201
(dp202
Vlabel
p203
V
sV_id
p204
g5
(g18
g19
NtRp205
S'Np\xc5_#\xa0\x0c68\x96-r'
p206
bsVref
p207
g5
(g49
g19
NtRp208
(dp209
g52
(dp210
sg54
Ventity
p211
sg56
Nsg57
g5
(g18
g19
NtRp212
S'Np\xc5_#\xa0\x0c68\x96-r'
p213
bsbsVdescription
p214
V
sVname
p215
Vc
ssVdataset
p216
(dp217
Vtime_axis
p218
Vtime.from.year
p219
sVdescription
p220
V
sVlabel
p221
VTest Dataset
p222
sVcurrency
p223
VGBP
p224
sV_id
p225
V42b402b83a4577ab2cc68ec2df2415c544257200
p226
sVref
p227
g5
(g49
g19
NtRp228
(dp229
g52
(dp230
sg54
Vdataset
p231
sg56
Nsg57
V42b402b83a4577ab2cc68ec2df2415c544257200
p232
sbsVname
p233
Vtest_dataset
p234
ssVcurrency
p235
VGBP
p236
sVentities
p237
(lp238
g5
(g18
g19
NtRp239
S'Np\xc5_#\xa0\x0c68\x96-r'
p240
bag5
(g18
g19
NtRp241
S'Np\xc5_#\xa0\x0c68\x96-q'
p242
basVamount
p243
F1000
sVtime
p244
(dp245
Vfrom
p246
(dp247
Vday
p248
I20090101
sVyear
p249
I2009
sssV_id
p250
V97bc4f587c0c24fb3a021e44ba22d7234142a6ba
p251
sa(dp252
Vfrom
p253
(dp254
Vlabel
p255
V
sV_id
p256
g5
(g18
g19
NtRp257
S'Np\xc5_#\xa0\x0c68\x96-q'
p258
bsVref
p259
g5
(g49
g19
NtRp260
(dp261
g52
(dp262
sg54
Ventity
p263
sg56
Nsg57
g5
(g18
g19
NtRp264
S'Np\xc5_#\xa0\x0c68\x96-q'
p265
bsbsVdescription
p266
V
sVname
p267
Vb
ssVname
p268
V____
p269
sVto
p270
(dp271
Vlabel
p272
V
sV_id
p273
g5
(g18
g19
NtRp274
S'Np\xc5_#\xa0\x0c68\x96-q'
p275
bsVref
p276
g5
(g49
g19
NtRp277
(dp278
g52
(dp279
sg54
Ventity
p280
sg56
Nsg57
g5
(g18
g19
NtRp281
S'Np\xc5_#\xa0\x0c68\x96-q'
p282
bsbsVdescription
p283
V
sVname
p284
Vb
ssVdataset
p285
(dp286
Vtime_axis
p287
Vtime.from.year
p288
sVdescription
p289
V
sVlabel
p290
VTest Dataset
p291
sVcurrency
p292
VGBP
p293
sV_id
p294
V42b402b83a4577ab2cc68ec2df2415c544257200
p295
sVref
p296
g5
(g49
g19
NtRp297
(dp298
g52
(dp299
sg54
Vdataset
p300
sg56
Nsg57
V42b402b83a4577ab2cc68ec2df2415c544257200
p301
sbsVname
p302
Vtest_dataset
p303
ssVcurrency
p304
VGBP
p305
sVentities
p306
(lp307
g5
(g18
g19
NtRp308
S'Np\xc5_#\xa0\x0c68\x96-q'
p309
basVamount
p310
F1000
sVtime
p311
(dp312
Vfrom
p313
(dp314
Vday
p315
I20090101
sVyear
p316
I2009
sssV_id
p317
Vda0babc910b527935a66e0e1bee93a6749e3b4e6
p318
sa(dp319
Vfrom
p320
(dp321
Vlabel
p322
V
sV_id
p323
g5
(g18
g19
NtRp324
S'Np\xc5_#\xa0\x0c68\x96-r'
p325
bsVref
p326
g5
(g49
g19
NtRp327
(dp328
g52
(dp329
sg54
Ventity
p330
sg56
Nsg57
g5
(g18
g19
NtRp331
S'Np\xc5_#\xa0\x0c68\x96-r'
p332
bsbsVdescription
p333
V
sVname
p334
Vc
ssVname
p335
V_____
p336
sVto
p337
(dp338
Vlabel
p339
V
sV_id
p340
g5
(g18
g19
NtRp341
S'Np\xc5_#\xa0\x0c68\x96-p'
p342
bsVref
p343
g5
(g49
g19
NtRp344
(dp345
g52
(dp346
sg54
Ventity
p347
sg56
Nsg57
g5
(g18
g19
NtRp348
S'Np\xc5_#\xa0\x0c68\x96-p'
p349
bsbsVdescription
p350
V
sVname
p351
Va
ssVdataset
p352
(dp353
Vtime_axis
p354
Vtime.from.year
p355
sVdescription
p356
V
sVlabel
p357
VTest Dataset
p358
sVcurrency
p359
VGBP
p360
sV_id
p361
V42b402b83a4577ab2cc68ec2df2415c544257200
p362
sVref
p363
g5
(g49
g19
NtRp364
(dp365
g52
(dp366
sg54
Vdataset
p367
sg56
Nsg57
V42b402b83a4577ab2cc68ec2df2415c544257200
p368
sbsVname
p369
Vtest_dataset
p370
ssVcurrency
p371
VGBP
p372
sVentities
p373
(lp374
g5
(g18
g19
NtRp375
S'Np\xc5_#\xa0\x0c68\x96-p'
p376
bag5
(g18
g19
NtRp377
S'Np\xc5_#\xa0\x0c68\x96-r'
p378
basVamount
p379
F1000
sVtime
p380
(dp381
Vfrom
p382
(dp383
Vday
p384
I20090101
sVyear
p385
I2009
sssV_id
p386
Vb72d4a31de8dd2078b36fb56baee4d4531e7325b
p387
sa(dp388
Vfrom
p389
(dp390
Vlabel
p391
V
sV_id
p392
g5
(g18
g19
NtRp393
S'Np\xc5_#\xa0\x0c68\x96-r'
p394
bsVref
p395
g5
(g49
g19
NtRp396
(dp397
g52
(dp398
sg54
Ventity
p399
sg56
Nsg57
g5
(g18
g19
NtRp400
S'Np\xc5_#\xa0\x0c68\x96-r'
p401
bsbsVdescription
p402
V
sVname
p403
Vc
ssVname
p404
V______
p405
sVto
p406
(dp407
Vlabel
p408
V
sV_id
p409
g5
(g18
g19
NtRp410
S'Np\xc5_#\xa0\x0c68\x96-q'
p411
bsVref
p412
g5
(g49
g19
NtRp413
(dp414
g52
(dp415
sg54
Ventity
p416
sg56
Nsg57
g5
(g18
g19
NtRp417
S'Np\xc5_#\xa0\x0c68\x96-q'
p418
bsbsVdescription
p419
V
sVname
p420
Vb
ssVdataset
p421
(dp422
Vtime_axis
p423
Vtime.from.year
p424
sVdescription
p425
V
sVlabel
p426
VTest Dataset
p427
sVcurrency
p428
VGBP
p429
sV_id
p430
V42b402b83a4577ab2cc68ec2df2415c544257200
p431
sVref
p432
g5
(g49
g19
NtRp433
(dp434
g52
(dp435
sg54
Vdataset
p436
sg56
Nsg57
V42b402b83a4577ab2cc68ec2df2415c544257200
p437
sbsVname
p438
Vtest_dataset
p439
ssVcurrency
p440
VGBP
p441
sVentities
p442
(lp443
g5
(g18
g19
NtRp444
S'Np\xc5_#\xa0\x0c68\x96-q'
p445
bag5
(g18
g19
NtRp446
S'Np\xc5_#\xa0\x0c68\x96-r'
p447
basVamount
p448
F1000
sVtime
p449
(dp450
Vfrom
p451
(dp452
Vday
p453
I20090101
sVyear
p454
I2009
sssV_id
p455
Vc3766f35419ca112e93ac31a83a7ec4556eeb400
p456
sasVdimension
p457
(lp458
(dp459
Vlabel
p460
VName
p461
sV_id
p462
g5
(g18
g19
NtRp463
S'Np\xc5_y\x88i\xa4\x84\x00\x00\x00'
p464
bsVdescription
p465
V
sVkey
p466
Vname
p467
sVdataset
p468
Vtest_dataset
p469
sa(dp470
Vlabel
p471
VLabel
p472
sV_id
p473
g5
(g18
g19
NtRp474
S'Np\xc5_y\x88i\xa4\x84\x00\x00\x01'
p475
bsVdescription
p476
V
sVkey
p477
Vlabel
p478
sVdataset
p479
Vtest_dataset
p480
sa(dp481
Vlabel
p482
VFrom
p483
sV_id
p484
g5
(g18
g19
NtRp485
S'Np\xc5_y\x88i\xa4\x84\x00\x00\x02'
p486
bsVdescription
p487
V
sVkey
p488
Vfrom
p489
sVdataset
p490
Vtest_dataset
p491
sasVclassifier
p492
(lp493
sVdataset
p494
(lp495
(dp496
Vtime_axis
p497
Vtime.from.year
p498
sVdescription
p499
V
sVlabel
p500
VTest Dataset
p501
sVcurrency
p502
VGBP
p503
sV_id
p504
V42b402b83a4577ab2cc68ec2df2415c544257200
p505
sVname
p506
Vtest_dataset
p507
sassS'indexes'
p508
(dp509
g14
(dp510
V_id_
p511
(dp512
Vkey
p513
(lp514
(V_id
I1
tp515
asVv
I0
ssVname_1
p516
(dp517
VdropDups
p518
I00
sVunique
p519
I01
sVkey
p520
(lp521
(Vname
I1
tp522
asVv
I0
sssg39
(dp523
Ventities_1
p524
(dp525
Vkey
p526
(lp527
(Ventities
I1
tp528
asVv
I0
ssVto._id_1_from._id_1_amount_1
p529
(dp530
Vkey
p531
(lp532
(Vto._id
I1
tp533
a(Vfrom._id
I1
tp534
a(Vamount
I1
tp535
asVv
I0
ssVclassifiers_1
p536
(dp537
Vkey
p538
(lp539
(Vclassifiers
I1
tp540
asVv
I0
ssV_id_
p541
(dp542
Vkey
p543
(lp544
(V_id
I1
tp545
asVv
I0
ssVto._id_1
p546
(dp547
Vkey
p548
(lp549
(Vto._id
I1
tp550
asVv
I0
ssVdataset._id_1
p551
(dp552
Vkey
p553
(lp554
(Vdataset._id
I1
tp555
asVv
I0
ssVfrom._id_1
p556
(dp557
Vkey
p558
(lp559
(Vfrom._id
I1
tp560
asVv
I0
ssVdataset.name_1
p561
(dp562
Vkey
p563
(lp564
(Vdataset.name
I1
tp565
asVv
I0
sssg457
(dp566
V_id_
p567
(dp568
Vkey
p569
(lp570
(V_id
I1
tp571
asVv
I0
ssVdataset_1_key_1
p572
(dp573
Vkey
p574
(lp575
(Vdataset
I1
tp576
a(Vkey
I1
tp577
asVv
I0
sssg492
(dp578
V_id_
p579
(dp580
Vkey
p581
(lp582
(V_id
I1
tp583
asVv
I0
ssVtaxonomy_1_name_1
p584
(dp585
Vkey
p586
(lp587
(Vtaxonomy
I1
tp588
a(Vname
I1
tp589
asVv
I0
sssg494
(dp590
V_id_
p591
(dp592
Vkey
p593
(lp594
(V_id
I1
tp595
asVv
I0
ssss.